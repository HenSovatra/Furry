{% extends "layouts/base.html" %} {% load static %} {% block title %}Admin
Dashboard{% endblock title %} {% block breadcrumb_page %}Dashboard{% endblock
breadcrumb_page %} {% block breadcrumb_title %}Dashboard{% endblock
breadcrumb_title %} {% block content %}
<style>
  /* Styles for the image carousel gradient overlay */
  .carousel-item::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      0deg,
      rgba(0, 0, 0, 0.7) 0%,
      /* Darker at the bottom */ rgba(0, 0, 0, 0) 70%
        /* Fade to transparent towards the top */
    );
    border-radius: inherit; /* Inherit border-radius from parent */
  }

  /* Optional: Adjust text color if needed, though it's already white */
  .carousel-caption h5,
  .carousel-caption p {
    color: white; /* Ensure text remains white */
    position: relative; /* Ensure text is above the overlay */
    z-index: 1; /* Place text above the overlay */
  }

  /* Style for active chart period button */
  .chart-period-btn.active {
    background-color: #5e72e4; /* Example primary color */
    color: white;
    border-color: #5e72e4;
  }
</style>

<div class="row">
  <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
    <div class="card">
      <div class="card-body p-3">
        <div class="row">
          <div class="col-8">
            <div class="numbers">
              <p class="text-sm mb-0 text-uppercase font-weight-bold">
                Total Products
              </p>
              <h5 class="font-weight-bolder">{{ total_products }}</h5>
              <p class="mb-0">
                <span
                  class="{% if product_growth >= 0 %}text-success{% else %}text-danger{% endif %} text-sm font-weight-bolder"
                >
                  {% if product_growth >= 0 %}+{% endif %}{{ product_growth }}%
                </span>
                since yesterday
              </p>
            </div>
          </div>
          <div class="col-4 text-end">
            <div
              class="icon icon-shape bg-gradient-primary shadow-primary text-center rounded-circle"
            >
              <img
                src="{% static 'assets/icons/product.png' %}"
                alt="Products"
                style="width: 30px"
              />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
    <div class="card">
      <div class="card-body p-3">
        <div class="row">
          <div class="col-8">
            <div class="numbers">
              <p class="text-sm mb-0 text-uppercase font-weight-bold">
                Total Customers
              </p>
              <h5 class="font-weight-bolder">{{ total_customers }}</h5>
              <p class="mb-0">
                <span class="text-success text-sm font-weight-bolder">+3%</span>
                since last week
              </p>
            </div>
          </div>
          <div class="col-4 text-end">
            <div
              class="icon icon-shape bg-gradient-danger shadow-danger text-center rounded-circle"
            >
              <img
                src="{% static 'assets/icons/user.png' %}"
                alt="Customers"
                style="width: 30px"
              />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
    <div class="card">
      <div class="card-body p-3">
        <div class="row">
          <div class="col-8">
            <div class="numbers">
              <p class="text-sm mb-0 text-uppercase font-weight-bold">
                Total Orders
              </p>
              <h5 class="font-weight-bolder">{{ total_orders }}</h5>
              <p class="mb-0">
                <span class="text-danger text-sm font-weight-bolder">-2%</span>
                since last quarter
              </p>
            </div>
          </div>
          <div class="col-4 text-end">
            <div
              class="icon icon-shape bg-gradient-success shadow-success text-center rounded-circle"
            >
              <img
                src="{% static 'assets/icons/order.png' %}"
                alt="Orders"
                style="width: 30px"
              />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-xl-3 col-sm-6">
    <div class="card">
      <div class="card-body p-3">
        <div class="row">
          <div class="col-8">
            <div class="numbers">
              <p class="text-sm mb-0 text-uppercase font-weight-bold">
                Total Revenue
              </p>
              <h5 class="font-weight-bolder">
                ${{ total_revenue|floatformat:2 }}
              </h5>
              <p class="mb-0">
                <span class="text-success text-sm font-weight-bolder">+5%</span>
                than last month
              </p>
            </div>
          </div>
          <div class="col-4 text-end">
            <div
              class="icon icon-shape bg-gradient-warning shadow-warning text-center rounded-circle"
            >
              <img
                src="{% static 'assets/icons/revenue.png' %}"
                alt="Revenue"
                style="width: 30px"
              />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="row mt-4">
  <div class="col-lg-7 mb-lg-0 mb-4">
    <div class="card z-index-2 h-100">
      <div class="card-header pb-0 pt-3 bg-transparent">
        <h6 class="text-capitalize">Product Overview</h6>
        {# Changed title for clarity #}
        <p class="text-sm mb-0">
          <i class="fa fa-arrow-up text-success"></i>
          <span class="font-weight-bold">{{ product_growth }}% more</span> in
          product growth
        </p>

        {# --- NEW UI FOR CHART PERIOD SELECTION --- #}
        <div
          class="btn-group btn-group-sm mt-3"
          role="group"
          aria-label="Chart Period Selection"
        >
          <button
            type="button"
            class="btn btn-outline-secondary chart-period-btn active"
            data-period="daily"
          >
            Daily
          </button>
          <button
            type="button"
            class="btn btn-outline-secondary chart-period-btn"
            data-period="weekly"
          >
            Weekly
          </button>
          <button
            type="button"
            class="btn btn-outline-secondary chart-period-btn"
            data-period="monthly"
          >
            Monthly
          </button>
          <button
            type="button"
            class="btn btn-outline-secondary chart-period-btn"
            data-period="yearly"
          >
            Yearly
          </button>
        </div>
        {# --- END NEW UI --- #}
      </div>
      <div class="card-body p-3">
        <div class="chart">
          <canvas id="chart-line" class="chart-canvas" height="300"></canvas>
        </div>
      </div>
    </div>
  </div>
  <div class="col-lg-5">
    <div class="card card-carousel h-100 p-3">
      <div
        id="carouselExampleCaptions"
        class="carousel slide h-100"
        data-bs-ride="carousel"
      >
        <div class="carousel-inner border-radius-lg h-100">
          <div
            class="carousel-item h-100 active"
            style="
              background-image: url('{% static 'assets\img\dog1.jpg' %}');
              background-size: cover;
            "
          >
            <div
              class="carousel-caption d-none d-md-block bottom-0 text-start start-0 ms-5"
            >
              <h5 class="text-white mb-1">New Products Arrived!</h5>
              <p>Check out the latest additions to our inventory.</p>
            </div>
          </div>
          <div
            class="carousel-item h-100"
            style="
              background-image: url('{% static 'assets\img\dog2.jpg' %}');
              background-size: cover;
            "
          >
            <div
              class="carousel-caption d-none d-md-block bottom-0 text-start start-0 ms-5"
            >
              <h5 class="text-white mb-1">Customer Feedback</h5>
              <p>Insights from our valued customers.</p>
            </div>
          </div>
          <div
            class="carousel-item h-100"
            style="
              background-image: url('{% static 'assets\img\pet1.jpg' %}');
              background-size: cover;
            "
          >
            <div
              class="carousel-caption d-none d-md-block bottom-0 text-start start-0 ms-5"
            >
              <h5 class="text-white mb-1">Upcoming Promotions</h5>
              <p>Don't miss out on our exciting deals!</p>
            </div>
          </div>
        </div>
        <button
          class="carousel-control-prev w-5 me-3"
          type="button"
          data-bs-target="#carouselExampleCaptions"
          data-bs-slide="prev"
        >
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button
          class="carousel-control-next w-5 me-3"
          type="button"
          data-bs-target="#carouselExampleCaptions"
          data-bs-slide="next"
        >
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
        </button>
      </div>
    </div>
  </div>
</div>

<div class="row mt-5">
  <div class="col-12">
    <div class="card">
      <div class="card-header pb-0">
        <h6>Latest Customer Feedback</h6>
      </div>
      <div class="card-body">
        {% if feedback_list %} {% for feedback in feedback_list %}
        <div class="mb-4 border-bottom pb-3">
          <h6 class="mb-1">{{ feedback.subject }}</h6>
          <p class="text-sm text-muted mb-1">
            By <strong>{{ feedback.user_display }}</strong> ({{ feedback.email
            }}) â€”
            <small>{{ feedback.submitted_at|date:"F j, Y, g:i a" }}</small>
          </p>
          <p>{{ feedback.message|truncatechars:300 }}</p>

          {% if feedback.images %}
          <div class="d-flex gap-2 flex-wrap">
            {% for image in feedback.images %}
            <img
              src="{{ image.image }}"
              class="img-thumbnail"
              style="width: 100px; height: auto"
            />
            {% endfor %}
          </div>
          {% endif %}
        </div>
        {% endfor %} {% else %}
        <p>No feedback available.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>

{% endblock content %} {% block extra_js %}
<script src="{% static 'assets/js/plugins/chartjs.min.js' %}"></script>
<script>
  // Store all aggregated data received from Django
  const allChartData = {
    daily: {{ daily_product_data|safe }},
    weekly: {{ weekly_product_data|safe }},
    monthly: {{ monthly_product_data|safe }},
    yearly: {{ yearly_product_data|safe }}
  };

  let productChart; // Declare a variable to hold the chart instance

  // Function to update the chart data
  function updateProductChart(period) {
    const dataForPeriod = allChartData[period];
    const labels = dataForPeriod.map(item => item.label);
    const values = dataForPeriod.map(item => item.value);

    // Update chart data and labels
    productChart.data.labels = labels;
    productChart.data.datasets[0].data = values;
    productChart.data.datasets[0].label = `Total Products (${period.charAt(0).toUpperCase() + period.slice(1)})`; // Update dataset label

    productChart.update(); // Re-render the chart
  }

  // --- Chart Initialization ---
  var ctx1 = document.getElementById("chart-line").getContext("2d");

  var gradientStroke1 = ctx1.createLinearGradient(0, 230, 0, 50);
  gradientStroke1.addColorStop(1, "rgba(94, 114, 228, 0.2)");
  gradientStroke1.addColorStop(0.2, "rgba(94, 114, 228, 0.0)");
  gradientStroke1.addColorStop(0, "rgba(94, 114, 228, 0)");

  // Initialize the chart with daily data by default
  const initialData = allChartData.daily;
  const initialLabels = initialData.map(item => item.label);
  const initialValues = initialData.map(item => item.value);

  productChart = new Chart(ctx1, {
    type: "line",
    data: {
      labels: initialLabels,
      datasets: [
        {
          label: "Total Products (Daily)", // Initial label
          tension: 0.4,
          borderWidth: 0,
          pointRadius: 0,
          borderColor: "#5e72e4",
          backgroundColor: gradientStroke1,
          borderWidth: 3,
          fill: true,
          data: initialValues,
          maxBarThickness: 6,
        },
      ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false,
        },
      },
      interaction: {
        intersect: false,
        mode: "index",
      },
      scales: {
        y: {
          grid: {
            drawBorder: false,
            display: true,
            drawOnChartArea: true,
            drawTicks: false,
            borderDash: [5, 5],
          },
          ticks: {
            display: true,
            padding: 10,
            color: "#fbfbfb",
            font: {
              size: 11,
              family: "Open Sans",
              style: "normal",
              lineHeight: 2,
            },
          },
        },
        x: {
          grid: {
            drawBorder: false,
            display: false,
            drawOnChartArea: false,
            drawTicks: false,
            borderDash: [5, 5],
          },
          ticks: {
            display: true,
            color: "#ccc",
            padding: 20,
            font: {
              size: 11,
              family: "Open Sans",
              style: "normal",
              lineHeight: 2,
            },
          },
        },
      },
    },
  });

  // --- Event Listeners for Period Buttons ---
  const periodButtons = document.querySelectorAll('.chart-period-btn');

  periodButtons.forEach(button => {
    button.addEventListener('click', function() {
      // Remove 'active' class from all buttons
      periodButtons.forEach(btn => btn.classList.remove('active'));
      // Add 'active' class to the clicked button
      this.classList.add('active');

      const period = this.dataset.period; // Get the period from data-period attribute
      updateProductChart(period); // Update the chart
    });
  });
</script>
{% endblock extra_js %}
